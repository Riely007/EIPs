(window.webpackJsonp=window.webpackJsonp||[]).push([[440],{851:function(e,t,a){"use strict";a.r(t);var s=a(46),n=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"simple-summary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#simple-summary"}},[e._v("#")]),e._v(" Simple Summary")]),e._v(" "),a("p",[e._v("Specification of the first step to transition Ethereum main net from Proof of Work (PoW) to Proof of Stake (PoS). The resulting consensus model is a PoW/PoS hybrid.")]),e._v(" "),a("h2",{attrs:{id:"abstract"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#abstract"}},[e._v("#")]),e._v(" Abstract")]),e._v(" "),a("p",[e._v("This EIP specifies a hybrid PoW/PoS consensus model for Ethereum main net. Existing PoW mechanics are used for new block creation, and a novel PoS mechanism called Casper the Friendly Finality Gadget (FFG) is layered on top using a smart contract.")]),e._v(" "),a("p",[e._v("Through the use of Ether deposits, slashing conditions, and a modified fork choice, FFG allows the underlying PoW blockchain to be finalized.  As network security is greatly shifted from PoW to PoS, PoW block rewards are reduced.")]),e._v(" "),a("p",[e._v("This EIP does not contain safety and liveness proofs or validator implementation details, but these can be found in the "),a("a",{attrs:{href:"https://arxiv.org/abs/1710.09437",target:"_blank",rel:"noopener noreferrer"}},[e._v("Casper FFG paper"),a("OutboundLink")],1),e._v(" and "),a("a",{attrs:{href:"https://github.com/ethereum/casper/blob/master/VALIDATOR_GUIDE.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("Validator Implementation Guide"),a("OutboundLink")],1),e._v(" respectively.")]),e._v(" "),a("h2",{attrs:{id:"glossary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#glossary"}},[e._v("#")]),e._v(" Glossary")]),e._v(" "),a("ul",[a("li",[a("strong",[e._v("epoch")]),e._v(": The span of blocks between checkpoints. Epochs are numbered starting at the hybrid casper fork, incrementing by one at the start of each epoch.")]),e._v(" "),a("li",[a("strong",[e._v("finality")]),e._v(": The point at which a block has been decided upon by a client to "),a("em",[e._v("never")]),e._v(" revert. Proof of Work does not have the concept of finality, only of further deep block confirmations.")]),e._v(" "),a("li",[a("strong",[e._v("checkpoint")]),e._v(": The block/hash under consideration for finality for a given epoch. This block is the "),a("em",[e._v("last")]),e._v(" block of the previous epoch. Rather than dealing with every block, Casper FFG only considers checkpoints for finalization. When a checkpoint is explicitly finalized, all ancestor blocks of the checkpoint are implicitly finalized.")]),e._v(" "),a("li",[a("strong",[e._v("validator")]),e._v(": A participant in the Casper FFG consensus that has deposited ether in the casper contract and has the responsibility to vote and finalize checkpoints.")]),e._v(" "),a("li",[a("strong",[e._v("validator set")]),e._v(": The set of validators in the casper contract at any given time.")]),e._v(" "),a("li",[a("strong",[e._v("dynasty")]),e._v(": The number of finalized checkpoints in the chain from root to the parent of a block. The dynasty is used to define when a validator starts and ends validating. The current dynasty only increments when a checkpoint is finalized as opposed to epoch numbers that increment regardless of finality.")]),e._v(" "),a("li",[a("strong",[e._v("slash")]),e._v(": The burning of some amount of a validator's deposit along with an immediate logout from the validator set. Slashing occurs when a validator signs two conflicting "),a("code",[e._v("vote")]),e._v(" messages that violate a slashing condition. For an in-depth discussion of slashing conditions, see the "),a("a",{attrs:{href:"https://arxiv.org/abs/1710.09437",target:"_blank",rel:"noopener noreferrer"}},[e._v("Casper FFG Paper"),a("OutboundLink")],1),e._v(".")])]),e._v(" "),a("h2",{attrs:{id:"motivation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#motivation"}},[e._v("#")]),e._v(" Motivation")]),e._v(" "),a("p",[e._v("Transitioning the Ethereum network from PoW to PoS has been on the roadmap and in the "),a("a",{attrs:{href:"https://github.com/ethereum/yellowpaper",target:"_blank",rel:"noopener noreferrer"}},[e._v("Yellow Paper"),a("OutboundLink")],1),e._v(" since the launch of the protocol. Although effective in coming to a decentralized consensus, PoW consumes an incredible amount of energy, has no economic finality, and has no effective strategy in resisting cartels. Excessive energy consumption, issues with equal access to mining hardware, mining pool centralization, and an emerging market of ASICs each provide a distinct motivation to make the transition as soon as possible.")]),e._v(" "),a("p",[e._v("Until recently, the proper way to make this transition was still an open area of research. In October of 2017 "),a("a",{attrs:{href:"https://arxiv.org/abs/1710.09437",target:"_blank",rel:"noopener noreferrer"}},[e._v("Casper the Friendly Finality Gadget"),a("OutboundLink")],1),e._v(' was published, solving open questions of economic finality through validator deposits and crypto-economic incentives. For a detailed discussion and proofs of "accountable safety" and "plausible liveness", see the '),a("a",{attrs:{href:"https://arxiv.org/abs/1710.09437",target:"_blank",rel:"noopener noreferrer"}},[e._v("Casper FFG"),a("OutboundLink")],1),e._v(" paper.")]),e._v(" "),a("p",[e._v("The Casper FFG contract can be layered on top of any block proposal mechanism, providing finality to the underlying chain. This EIP proposes layering FFG on top of the existing PoW block proposal mechanism as a conservative step-wise approach in the transition to full PoS. The new FFG staking mechanism requires minimal changes to the protocol, allowing the Ethereum network to fully test and evaluate Casper FFG on top of PoW before moving to a validator based block proposal mechanism.")]),e._v(" "),a("h2",{attrs:{id:"parameters"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#parameters"}},[e._v("#")]),e._v(" Parameters")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("HYBRID_CASPER_FORK_BLKNUM")]),e._v(": TBD")]),e._v(" "),a("li",[a("code",[e._v("CASPER_ADDR")]),e._v(": TBD")]),e._v(" "),a("li",[a("code",[e._v("CASPER_CODE")]),e._v(": see below")]),e._v(" "),a("li",[a("code",[e._v("CASPER_BALANCE")]),e._v(": 1.25e24 wei (1,250,000 ETH)")]),e._v(" "),a("li",[a("code",[e._v("MSG_HASHER_ADDR")]),e._v(": TBD")]),e._v(" "),a("li",[a("code",[e._v("MSG_HASHER_CODE")]),e._v(": see below")]),e._v(" "),a("li",[a("code",[e._v("PURITY_CHECKER_ADDR")]),e._v(": TBD")]),e._v(" "),a("li",[a("code",[e._v("PURITY_CHECKER_CODE")]),e._v(": see below")]),e._v(" "),a("li",[a("code",[e._v("NULL_SENDER")]),e._v(": "),a("code",[e._v("2**160 - 1")])]),e._v(" "),a("li",[a("code",[e._v("NEW_BLOCK_REWARD")]),e._v(": 6e17 wei (0.6 ETH)")]),e._v(" "),a("li",[a("code",[e._v("REWARD_STEPDOWN_BLOCK_COUNT")]),e._v(": 5.5e5 blocks (~3 months)")]),e._v(" "),a("li",[a("code",[e._v("CASPER_INIT_DATA")]),e._v(": TBD")]),e._v(" "),a("li",[a("code",[e._v("VOTE_BYTES")]),e._v(": "),a("code",[e._v("0xe9dc0614")])]),e._v(" "),a("li",[a("code",[e._v("INITIALIZE_EPOCH_BYTES")]),e._v(": "),a("code",[e._v("0x5dcffc17")])]),e._v(" "),a("li",[a("code",[e._v("NON_REVERT_MIN_DEPOSIT")]),e._v(": amount in wei configurable by client")])]),e._v(" "),a("h3",{attrs:{id:"casper-contract-parameters"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#casper-contract-parameters"}},[e._v("#")]),e._v(" Casper Contract Parameters")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("EPOCH_LENGTH")]),e._v(": 50 blocks")]),e._v(" "),a("li",[a("code",[e._v("WARM_UP_PERIOD")]),e._v(": 1.8e5 blocks (~1 month)")]),e._v(" "),a("li",[a("code",[e._v("WITHDRAWAL_DELAY")]),e._v(": 1.5e4 epochs")]),e._v(" "),a("li",[a("code",[e._v("DYNASTY_LOGOUT_DELAY")]),e._v(": 700 dynasties")]),e._v(" "),a("li",[a("code",[e._v("BASE_INTEREST_FACTOR")]),e._v(": 7e-3")]),e._v(" "),a("li",[a("code",[e._v("BASE_PENALTY_FACTOR")]),e._v(": 2e-7")]),e._v(" "),a("li",[a("code",[e._v("MIN_DEPOSIT_SIZE")]),e._v(": 1.5e21 wei (1500 ETH)")])]),e._v(" "),a("h2",{attrs:{id:"specification"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#specification"}},[e._v("#")]),e._v(" Specification")]),e._v(" "),a("h4",{attrs:{id:"deploying-casper-contract"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deploying-casper-contract"}},[e._v("#")]),e._v(" Deploying Casper Contract")]),e._v(" "),a("p",[e._v("If "),a("code",[e._v("block.number == HYBRID_CASPER_FORK_BLKNUM")]),e._v(", then when processing the block before processing any transactions:")]),e._v(" "),a("ul",[a("li",[e._v("set the code of "),a("code",[e._v("MSG_HASHER_ADDR")]),e._v(" to "),a("code",[e._v("MSG_HASHER_CODE")])]),e._v(" "),a("li",[e._v("set the code of "),a("code",[e._v("PURITY_CHECKER_ADDR")]),e._v(" to "),a("code",[e._v("PURITY_CHECKER_CODE")])]),e._v(" "),a("li",[e._v("set the code of "),a("code",[e._v("CASPER_ADDR")]),e._v(" to "),a("code",[e._v("CASPER_CODE")])]),e._v(" "),a("li",[e._v("set balance of "),a("code",[e._v("CASPER_ADDR")]),e._v(" to "),a("code",[e._v("CASPER_BALANCE")])])]),e._v(" "),a("p",[e._v("Then execute a "),a("code",[e._v("CALL")]),e._v(" with the following parameters before executing any normal block transactions:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("SENDER")]),e._v(": "),a("code",[e._v("NULL_SENDER")])]),e._v(" "),a("li",[a("code",[e._v("GAS")]),e._v(": 3141592")]),e._v(" "),a("li",[a("code",[e._v("TO")]),e._v(": "),a("code",[e._v("CASPER_ADDR")])]),e._v(" "),a("li",[a("code",[e._v("VALUE")]),e._v(": 0")]),e._v(" "),a("li",[a("code",[e._v("NONCE")]),e._v(": 0")]),e._v(" "),a("li",[a("code",[e._v("GASPRICE")]),e._v(": 0")]),e._v(" "),a("li",[a("code",[e._v("DATA")]),e._v(": "),a("code",[e._v("CASPER_INIT_DATA")])])]),e._v(" "),a("p",[e._v("This "),a("code",[e._v("CALL")]),e._v(" utilizes no gas and does not increment the nonce of "),a("code",[e._v("NULL_SENDER")])]),e._v(" "),a("h4",{attrs:{id:"initialize-epochs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#initialize-epochs"}},[e._v("#")]),e._v(" Initialize Epochs")]),e._v(" "),a("p",[e._v("If "),a("code",[e._v("block.number >= (HYBRID_CASPER_FORK_BLKNUM + WARM_UP_PERIOD)")]),e._v(" and "),a("code",[e._v("block.number % EPOCH_LENGTH == 0")]),e._v(", execute a "),a("code",[e._v("CALL")]),e._v(" with the following parameters before executing any normal block transactions:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("SENDER")]),e._v(": "),a("code",[e._v("NULL_SENDER")])]),e._v(" "),a("li",[a("code",[e._v("GAS")]),e._v(": 3141592")]),e._v(" "),a("li",[a("code",[e._v("TO")]),e._v(": "),a("code",[e._v("CASPER_ADDR")])]),e._v(" "),a("li",[a("code",[e._v("VALUE")]),e._v(": 0")]),e._v(" "),a("li",[a("code",[e._v("NONCE")]),e._v(": 0")]),e._v(" "),a("li",[a("code",[e._v("GASPRICE")]),e._v(": 0")]),e._v(" "),a("li",[a("code",[e._v("DATA")]),e._v(": "),a("code",[e._v("INITIALIZE_EPOCH_BYTES")]),e._v(" followed by the 32-byte encoding of "),a("code",[e._v("floor(block.number / EPOCH_LENGTH)")])])]),e._v(" "),a("p",[e._v("This "),a("code",[e._v("CALL")]),e._v(" utilizes no gas and does not increment the nonce of "),a("code",[e._v("NULL_SENDER")])]),e._v(" "),a("h4",{attrs:{id:"casper-votes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#casper-votes"}},[e._v("#")]),e._v(" Casper Votes")]),e._v(" "),a("p",[e._v("A "),a("code",[e._v("vote")]),e._v(" transaction is defined as a transaction with the following parameters:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("TO")]),e._v(": "),a("code",[e._v("CASPER_ADDR")])]),e._v(" "),a("li",[a("code",[e._v("DATA")]),e._v(": Begins with "),a("code",[e._v("VOTE_BYTES")])])]),e._v(" "),a("p",[e._v("If "),a("code",[e._v("block.number >= HYBRID_CASPER_FORK_BLKNUM")]),e._v(", then:")]),e._v(" "),a("ul",[a("li",[e._v("A valid "),a("code",[e._v("vote")]),e._v(" transaction to "),a("code",[e._v("CASPER_ADDR")]),e._v(" must satisfy each of the following:\n"),a("ul",[a("li",[e._v("Must have the following signature "),a("code",[e._v("(CHAIN_ID, 0, 0)")]),e._v(" (ie. "),a("code",[e._v("r = s = 0, v = CHAIN_ID")]),e._v(")")]),e._v(" "),a("li",[e._v("Must have "),a("code",[e._v("value == nonce == gasprice == 0")])])])]),e._v(" "),a("li",[e._v("When producing and validating a block, when handling "),a("code",[e._v("vote")]),e._v(" transactions to "),a("code",[e._v("CASPER_ADDR")]),e._v(":\n"),a("ul",[a("li",[e._v('Only include "valid" '),a("code",[e._v("vote")]),e._v(" transactions as defined above")]),e._v(" "),a("li",[e._v("Place all "),a("code",[e._v("vote")]),e._v(" transactions at the end of the block")]),e._v(" "),a("li",[e._v("Track cumulative gas used by votes separately from cumulative gas used by normal transactions via "),a("code",[e._v("vote_gas_used")])]),e._v(" "),a("li",[e._v("Total "),a("code",[e._v("vote_gas_used")]),e._v(" of "),a("code",[e._v("vote")]),e._v(" transactions cannot exceed the "),a("code",[e._v("block_gas_limit")]),e._v(", independent of gas used by normal block transactions")])])]),e._v(" "),a("li",[e._v("When applying "),a("code",[e._v("vote")]),e._v(" transactions to "),a("code",[e._v("CASPER_ADDR")]),e._v(" to vm state:\n"),a("ul",[a("li",[e._v("Set sender to "),a("code",[e._v("NULL_SENDER")])]),e._v(" "),a("li",[e._v("Count gas of "),a("code",[e._v("vote")]),e._v(" toward "),a("code",[e._v("vote_gas_used")])]),e._v(" "),a("li",[e._v("Do not count gas of "),a("code",[e._v("vote")]),e._v(" toward the normal "),a("code",[e._v("gas_used")]),e._v(". For all "),a("code",[e._v("vote")]),e._v(" transaction receipts, cumulative gas used is equal to last non-"),a("code",[e._v("vote")]),e._v(" transaction receipt")]),e._v(" "),a("li",[e._v("Do not increment the nonce of "),a("code",[e._v("NULL_SENDER")])])])]),e._v(" "),a("li",[e._v("All unsuccessful "),a("code",[e._v("vote")]),e._v(" transactions to "),a("code",[e._v("CASPER_ADDR")]),e._v(" are invalid and must not be included in the block")])]),e._v(" "),a("h4",{attrs:{id:"fork-choice-and-finalization"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fork-choice-and-finalization"}},[e._v("#")]),e._v(" Fork Choice and Finalization")]),e._v(" "),a("p",[e._v("If "),a("code",[e._v("block.number >= HYBRID_CASPER_FORK_BLKNUM")]),e._v(", the fork choice rule is the logic represented by the following pseudocode. Note that options "),a("code",[e._v("--casper-fork-choice")]),e._v(" and "),a("code",[e._v("--exclude")]),e._v(' are discussed below in "Client Settings".')]),e._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("def")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("handle_block")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("new_block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("not")]),e._v(" is_new_head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("new_block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v("\n\n    set_head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("new_block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("casper"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("fork"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("choice "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("is")]),e._v(" on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n        check_and_finalize_new_checkpoint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("new_block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("def")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("is_new_head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("new_block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("casper"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("fork"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("choice "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("is")]),e._v(" off\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# old pure PoW chain scoring rule")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" new_block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("total_difficuty "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" current_head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("total_difficulty\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" new_block "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("is")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("exclude "),a("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("list")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("or")]),e._v(" one of its descendants\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" false\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# don't revert finalized blocks")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("last_finalized_block "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("is")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("not")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" new_block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("ancestors"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" false\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# new casper chain scoring rule")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" highest_justified_epoch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("new_block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("**")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("40")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+")]),e._v(" new_block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("total_difficuty "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n        highest_justified_epoch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("current_head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("**")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("40")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+")]),e._v(" current_head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("total_difficulty\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("def")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("highest_justified_epoch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    casper "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("post_state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("casper_contract\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" casper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("highest_justified_epoch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("NON_REVERT_MIN_DEPOSITS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("def")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("check_and_finalize_new_checkpoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("new_block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    casper "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" new_block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("post_state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("casper_contract\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# If no finalized blocks, db.last_finalized_epoch initialized to -1")]),e._v("\n\n    finalized_epoch "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" casper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("highest_finalized_epoch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("NON_REVERT_MIN_DEPOSITS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" finalized_epoch "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("last_finalized_epoch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n        finalized_hash "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" casper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("checkpoint_hashes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("finalized_epoch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# ensure not trivially finalized")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" finalized_hash "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("b'\\x00'")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("32")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v("\n\n        db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("last_finalized_epoch "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" finalized_epoch\n        db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("last_finalized_block "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" finalized_hash\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br"),a("span",{staticClass:"line-number"},[e._v("25")]),a("br"),a("span",{staticClass:"line-number"},[e._v("26")]),a("br"),a("span",{staticClass:"line-number"},[e._v("27")]),a("br"),a("span",{staticClass:"line-number"},[e._v("28")]),a("br"),a("span",{staticClass:"line-number"},[e._v("29")]),a("br"),a("span",{staticClass:"line-number"},[e._v("30")]),a("br"),a("span",{staticClass:"line-number"},[e._v("31")]),a("br"),a("span",{staticClass:"line-number"},[e._v("32")]),a("br"),a("span",{staticClass:"line-number"},[e._v("33")]),a("br"),a("span",{staticClass:"line-number"},[e._v("34")]),a("br"),a("span",{staticClass:"line-number"},[e._v("35")]),a("br"),a("span",{staticClass:"line-number"},[e._v("36")]),a("br"),a("span",{staticClass:"line-number"},[e._v("37")]),a("br"),a("span",{staticClass:"line-number"},[e._v("38")]),a("br"),a("span",{staticClass:"line-number"},[e._v("39")]),a("br"),a("span",{staticClass:"line-number"},[e._v("40")]),a("br"),a("span",{staticClass:"line-number"},[e._v("41")]),a("br"),a("span",{staticClass:"line-number"},[e._v("42")]),a("br"),a("span",{staticClass:"line-number"},[e._v("43")]),a("br"),a("span",{staticClass:"line-number"},[e._v("44")]),a("br"),a("span",{staticClass:"line-number"},[e._v("45")]),a("br"),a("span",{staticClass:"line-number"},[e._v("46")]),a("br")])]),a("p",[e._v("The new chain scoring rule queries the casper contract to find the highest justified epoch that meets the client's minimum deposit requirement ("),a("code",[e._v("NON_REVERT_MIN_DEPOSITS")]),e._v("). The "),a("code",[e._v("10**40")]),e._v(" multiplier ensures that the justified epoch takes precedence over block mining difficulty. "),a("code",[e._v("total_difficulty")]),e._v(" only serves as a tie breaker if the two blocks in question have an equivalent "),a("code",[e._v("highest_justified_epoch")]),e._v(".")]),e._v(" "),a("p",[a("em",[e._v("Note")]),e._v(": If the client has no justified checkpoints, the contract returns "),a("code",[e._v("highest_justified_epoch")]),e._v(" as "),a("code",[e._v("0")]),e._v(" essentially reverting the fork choice rule to pure PoW.")]),e._v(" "),a("p",[e._v("When assessing a new block as the chain's head, clients must "),a("em",[e._v("never revert finalized blocks")]),e._v(' as seen by the code commented as "don\'t revert finalized blocks".')]),e._v(" "),a("p",[e._v("When a new block is added as the chain's head, clients then check for a new finalized block. This is handled by the "),a("code",[e._v("check_and_finalized_new_checkpoint(new_block)")]),e._v(" method above. If the highest finalized epoch in the casper contract is greater than the previous finalized epoch, then the client finalizes the block with the hash "),a("code",[e._v("casper.checkpoint_hashes(finalized_epoch)")]),e._v(", storing this block and the related epoch number in the client database as finalized.")]),e._v(" "),a("p",[e._v("Clients only consider checkpoints justified or finalized if deposits were greater than "),a("code",[e._v("NON_REVERT_MIN_DEPOSIT")]),e._v(" "),a("em",[e._v("during the epoch in question")]),e._v(". This logic is encapsulated in "),a("code",[e._v("casper.highest_justified_epoch(NON_REVERT_MIN_DEPOSIT)")]),e._v(" and "),a("code",[e._v("casper.highest_finalized_epoch(NON_REVERT_MIN_DEPOSIT)")]),e._v(", respectively.")]),e._v(" "),a("h4",{attrs:{id:"block-reward"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#block-reward"}},[e._v("#")]),e._v(" Block Reward")]),e._v(" "),a("p",[e._v("If "),a("code",[e._v("block.number >= HYBRID_CASPER_FORK_BLKNUM")]),e._v(", then "),a("code",[e._v("block_reward")]),e._v(" is defined by the following logic and utilizes the same formulas for ommer rewards but with the updated "),a("code",[e._v("block_reward")]),e._v(".")]),e._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("number "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" HYBRID_CASPER_FORK_BLKNUM "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+")]),e._v(" REWARD_STEPDOWN_BLOCK_COUNT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    block_reward "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("5")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" NEW_BLOCK_REWARD\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("elif")]),e._v(" block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("number "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" HYBRID_CASPER_FORK_BLKNUM "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("REWARD_STEPDOWN_BLOCK_COUNT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    block_reward "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" NEW_BLOCK_REWARD\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("elif")]),e._v(" block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("number "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" HYBRID_CASPER_FORK_BLKNUM "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("REWARD_STEPDOWN_BLOCK_COUNT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    block_reward "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" NEW_BLOCK_REWARD\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("elif")]),e._v(" block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("number "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" HYBRID_CASPER_FORK_BLKNUM "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("REWARD_STEPDOWN_BLOCK_COUNT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    block_reward "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" NEW_BLOCK_REWARD\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("else")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    block_reward "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" NEW_BLOCK_REWARD\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br")])]),a("h4",{attrs:{id:"validators"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#validators"}},[e._v("#")]),e._v(" Validators")]),e._v(" "),a("p",[e._v("The mechanics and responsibilities of validators are not specified in this EIP because they rely upon network transactions to the contract at "),a("code",[e._v("CASPER_ADDR")]),e._v(" rather than on protocol level implementation and changes. See the "),a("a",{attrs:{href:"https://github.com/ethereum/casper/blob/master/VALIDATOR_GUIDE.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("Validator Implementation Guide"),a("OutboundLink")],1),e._v(" for validator details.")]),e._v(" "),a("h4",{attrs:{id:"msg-hasher-code"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#msg-hasher-code"}},[e._v("#")]),e._v(" MSG_HASHER_CODE")]),e._v(" "),a("p",[e._v("The source code for "),a("code",[e._v("MSG_HASHER_CODE")]),e._v(" is located "),a("a",{attrs:{href:"https://github.com/ethereum/casper/blob/master/casper/contracts/msg_hash.se.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1),e._v(". The source is to be migrated to Vyper LLL before the bytecode is finalized for this EIP.")]),e._v(" "),a("p",[e._v("The EVM init code is:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("TBD\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("The EVM bytecode that the contract should be set to is:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("TBD\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h4",{attrs:{id:"purity-checker-code"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#purity-checker-code"}},[e._v("#")]),e._v(" PURITY_CHECKER_CODE")]),e._v(" "),a("p",[e._v("The source code for "),a("code",[e._v("PURITY_CHECKER_CODE")]),e._v(" is located "),a("a",{attrs:{href:"https://github.com/ethereum/research/blob/master/impurity/check_for_impurity.se",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1),e._v(". The source is to be migrated to Vyper LLL before the bytecode is finalized for this EIP.")]),e._v(" "),a("p",[e._v("The EVM init code is:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("TBD\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("The EVM bytecode that the contract should be set to is:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("TBD\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h4",{attrs:{id:"casper-code"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#casper-code"}},[e._v("#")]),e._v(" CASPER_CODE")]),e._v(" "),a("p",[e._v("The source code for "),a("code",[e._v("CASPER_CODE")]),e._v(" is located at "),a("a",{attrs:{href:"https://github.com/ethereum/casper/blob/master/casper/contracts/simple_casper.v.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1),e._v(". The contract is to be formally verified and further tested before the bytecode is finalized for this EIP.")]),e._v(" "),a("p",[e._v("The EVM init code with the above specified params is:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("TBD\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("The EVM bytecode that the contract should be set to is:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("TBD\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h4",{attrs:{id:"client-settings"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#client-settings"}},[e._v("#")]),e._v(" Client Settings")]),e._v(" "),a("p",[e._v("Clients should be implemented with the following configurable settings:")]),e._v(" "),a("h5",{attrs:{id:"enable-casper-fork-choice"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#enable-casper-fork-choice"}},[e._v("#")]),e._v(" Enable Casper Fork Choice")]),e._v(" "),a("p",[e._v("The ability to enable/disable the Casper Fork Choice. A suggested implementation is "),a("code",[e._v("--casper-fork-choice")]),e._v(".")]),e._v(" "),a("p",[e._v("This setting should ship as default disabled in client versions during the initial casper fork. This setting should ship as default enabled in subsequent client versions.")]),e._v(" "),a("h5",{attrs:{id:"non-revert-min-deposit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#non-revert-min-deposit"}},[e._v("#")]),e._v(" NON_REVERT_MIN_DEPOSIT")]),e._v(" "),a("p",[e._v("The minimum size of total deposits that the client must observe in the FFG contract for the state of the contract to affect the client's fork choice. A suggested implementation is "),a("code",[e._v("--non-revert-min-deposit WEI_VALUE")]),e._v(".")]),e._v(" "),a("p",[e._v("The suggested default value that clients should ship with is at least 2e23 wei (200K ETH).")]),e._v(" "),a("p",[e._v('See "Fork Choice" more details.')]),e._v(" "),a("h5",{attrs:{id:"exclusion"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#exclusion"}},[e._v("#")]),e._v(" Exclusion")]),e._v(" "),a("p",[e._v("The ability to exclude a specified blockhash and all of its descendants from a client's fork choice. A suggested implementation is "),a("code",[e._v("--exclude BLOCKHASHES")]),e._v(", where "),a("code",[e._v("BLOCK_HASHES")]),e._v(" is a comma delimited list of blockhashes to exclude.")]),e._v(" "),a("p",[e._v("Note: this "),a("em",[e._v("can")]),e._v(" by design override a client's forkchoice and revert finalized blocks.")]),e._v(" "),a("h5",{attrs:{id:"join-fork"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#join-fork"}},[e._v("#")]),e._v(" Join Fork")]),e._v(" "),a("p",[e._v("The ability to manually join a fork specified by a blockhash. A suggested implementation is "),a("code",[e._v("--join-fork BLOCKHASH")]),e._v(" where the client automatically sets the head to the block defined by"),a("code",[e._v("BLOCKHASH")]),e._v(" and locally finalizes it.")]),e._v(" "),a("p",[e._v("Note: this "),a("em",[e._v("can")]),e._v(" by design override a client's forkchoice and revert finalized blocks.")]),e._v(" "),a("h5",{attrs:{id:"monitor-votes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#monitor-votes"}},[e._v("#")]),e._v(" Monitor Votes")]),e._v(" "),a("p",[e._v("The ability to monitor incoming "),a("code",[e._v("vote")]),e._v(" transactions for slashing conditions and submit proof to the casper contract for a finder's fee if found. A suggested implementation is "),a("code",[e._v("--monitor-votes")]),e._v(".")]),e._v(" "),a("p",[e._v("The setting should default to disabled.")]),e._v(" "),a("p",[e._v("The following pseudocode defines when two "),a("code",[e._v("vote")]),e._v(" messages violate a slashing condition. A "),a("code",[e._v("vote")]),e._v(" message is the singular argument included in a "),a("code",[e._v("vote")]),e._v(" transaction.")]),e._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("def")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("decode_rlp_list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("vote_msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# [validator_index, target_hash, target_epoch, source_epoch, signature]")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" RLPList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("vote_msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("bytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("bytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("def")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("same_target_epoch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("vote_msg_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" vote_msg_2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    decoded_values_1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" decode_rlp_msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("vote_msg_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    target_epoch_1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" decoded_values_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n\n    decoded_values_2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" decode_rlp_msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("vote_msg_2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    target_epoch_2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" decoded_values_2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" target_epoch_1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),e._v(" target_epoch_2\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("def")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("surrounds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("vote_msg_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" vote_msg_2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    decoded_values_1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" decode_rlp_msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("vote_msg_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    target_epoch_1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" decoded_values_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n    source_epoch_1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" decoded_values_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n\n    decoded_values_2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" decode_rlp_msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("vote_msg_2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    target_epoch_2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" decoded_values_2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n    source_epoch_1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" decoded_values_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n\n    vote_1_surrounds_vote_2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" target_epoch_1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" target_epoch_2 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("and")]),e._v(" source_epoch_1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" source_epoch_2\n    vote_2_surrounds_vote_1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" target_epoch_2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" target_epoch_1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("and")]),e._v(" source_epoch_2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" source_epoch_1\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" vote_1_surrounds_vote_2 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("or")]),e._v(" vote_2_surrounds_vote_1\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("def")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("violates_slashing_condition")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("vote_msg_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" vote_msg_2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" same_target_epoch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("vote_msg_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" vote_msg_2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("or")]),e._v(" surrounds"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("vote_msg_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" vote_msg_2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br"),a("span",{staticClass:"line-number"},[e._v("25")]),a("br"),a("span",{staticClass:"line-number"},[e._v("26")]),a("br"),a("span",{staticClass:"line-number"},[e._v("27")]),a("br"),a("span",{staticClass:"line-number"},[e._v("28")]),a("br"),a("span",{staticClass:"line-number"},[e._v("29")]),a("br")])]),a("p",[e._v("The casper contract also provides a helper method "),a("code",[e._v("slashable(vote_msg_1, vote_msg_2)")]),e._v(" to check if two votes violate a slashing condition. Clients should use the above pseudocode in combination with "),a("code",[e._v("casper.slashable()")]),e._v(" as a final check when deciding whether to submit a "),a("code",[e._v("slash")]),e._v(" to the contract.")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("--monitor-votes")]),e._v(" setting is to be used for clients that wish to monitor vote transactions for slashing conditions. If a slashing condition is found, the client creates and sends a transaction to "),a("code",[e._v("slash")]),e._v(" on the casper contract. The first transaction to include the slashing condition proof slashes the validator in question and sends a 4% finder's fee to the transaction sender.")]),e._v(" "),a("h2",{attrs:{id:"rationale"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rationale"}},[e._v("#")]),e._v(" Rationale")]),e._v(" "),a("p",[e._v('Naive PoS specifications and implementations have existed since early blockchain days, but most are vulnerable to serious attacks and do not hold up under crypto-economic analysis. Casper FFG solves problems such as "Nothing at Stake" and "Long Range Attacks" through requiring validators to post slashable deposits and through defining economic finality.')]),e._v(" "),a("h4",{attrs:{id:"minimize-consensus-changes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#minimize-consensus-changes"}},[e._v("#")]),e._v(" Minimize Consensus Changes")]),e._v(" "),a("p",[e._v("The finality gadget is designed to minimize changes across clients. For this reason, FFG is implemented within the EVM, so that the contract byte code encapsulates most of the complexity of the fork.")]),e._v(" "),a("p",[e._v("Most other decisions were made to minimize changes across clients. For example, it would be possible to allow "),a("code",[e._v("CASPER_ADDR")]),e._v(" to mint Ether each time it paid rewards (as compared to creating the contract with "),a("code",[e._v("CASPER_BALANCE")]),e._v("), but this would be more invasive and error-prone than relying on existing EVM mechanics.")]),e._v(" "),a("h4",{attrs:{id:"deploying-casper-contract-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deploying-casper-contract-2"}},[e._v("#")]),e._v(" Deploying Casper Contract")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("MSG_HASHER_CODE")]),e._v(" and "),a("code",[e._v("PURITY_CHECKER_CODE")]),e._v(" both do not require any initialization so the EVM bytecode can simply be placed at "),a("code",[e._v("MSG_HASHER_ADDR")]),e._v(" and "),a("code",[e._v("PURITY_CHECKER_ADDR")]),e._v(". On the other hand, the casper contract "),a("em",[e._v("does")]),e._v(' require passing in parameters and initialization of state. This initialization would normally occur by the EVM init code interacting with the CREATE opcode. Due to the nature of this contract being deployed outside of normal block transactions and to a particular address, the EVM init code/CREATE method requires client specific "hacks" to make it work. For simplicity of specifying across clients, the EVM bytecode -- '),a("code",[e._v("CASPER_CODE")]),e._v(" -- is placed at "),a("code",[e._v("CASPER_ADDR")]),e._v(" followed by an explicit "),a("code",[e._v("CALL")]),e._v(" to a one-time "),a("code",[e._v("init")]),e._v(" method on the casper contract. "),a("code",[e._v("init")]),e._v(" handles all of the logic that a constructor normally would, accepting contract parameters as arguments and setting initial variable values, and can only be run "),a("em",[e._v("once")]),e._v(".")]),e._v(" "),a("p",[a("code",[e._v("CASPER_INIT_DATA")]),e._v(" is composed of the the byte signature of the "),a("code",[e._v("init")]),e._v(" method of the casper contract concatenated with the 32-byte encodings of the following variables in the following order:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("EPOCH_LENGTH")])]),e._v(" "),a("li",[a("code",[e._v("WITHDRAWAL_DELAY")])]),e._v(" "),a("li",[a("code",[e._v("DYNASTY_LOGOUT_DELAY")])]),e._v(" "),a("li",[a("code",[e._v("MSG_HASHER_ADDR")])]),e._v(" "),a("li",[a("code",[e._v("PURITY_CHECKER_ADDR")])]),e._v(" "),a("li",[a("code",[e._v("BASE_INTEREST_FACTOR")])]),e._v(" "),a("li",[a("code",[e._v("BASE_PENALTY_FACTOR")])]),e._v(" "),a("li",[a("code",[e._v("MIN_DEPOSIT_SIZE")])])]),e._v(" "),a("p",[e._v("The entirety of this data is provided as a bytestring -- "),a("code",[e._v("CASPER_INIT_DATA")]),e._v(" -- to reduce the chance of encoding errors across clients, especially regarding fixed decimal types which are new in vyper and not yet supported by all clients.")]),e._v(" "),a("h4",{attrs:{id:"casper-contract-params"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#casper-contract-params"}},[e._v("#")]),e._v(" Casper Contract Params")]),e._v(" "),a("p",[a("code",[e._v("EPOCH_LENGTH")]),e._v(" is set to 50 blocks as a balance between time to finality and message overhead.")]),e._v(" "),a("p",[a("code",[e._v("WARM_UP_PERIOD")]),e._v(" is set to 1.8e5 blocks to provide validators with an approximate 1 month period to make initial deposits before full contract functionality and voting begin. This helps prevent degenerate cases such as having very few or even just one validator in the initial dynasty. This 1 month period also gives the network time to observe on the order of how many validators will initially be participating in consensus. If for some reason there is an unexpectedly low turnout, the community might choose to delay validation and consider design alternatives.")]),e._v(" "),a("p",[a("code",[e._v("WITHDRAWAL_DELAY")]),e._v(" is set to 15000 epochs to freeze a validator's funds for approximately 4 months after logout. This allows for at least a 4 month window to identify and slash a validator for attempting to finalize two conflicting checkpoints. This also defines the window of time with which a client must log on to sync the network due to weak subjectivity.")]),e._v(" "),a("p",[a("code",[e._v("DYNASTY_LOGOUT_DELAY")]),e._v(" is set to 700 dynasties to prevent immediate logout in the event of an attack from being a viable strategy.")]),e._v(" "),a("p",[a("code",[e._v("BASE_INTEREST_FACTOR")]),e._v(" is set to 7e-3 such that if there are ~10M ETH in total deposits, then validators earn approximately 5% per year in ETH rewards under optimal FFG conditions.")]),e._v(" "),a("p",[a("code",[e._v("BASE_PENALTY_FACTOR")]),e._v(" is set to 2e-7 such that if 50% of deposits go offline, then offline validators lose half of their deposits in approximately 3 weeks, at which the online portion of validators becomes a 2/3 majority and can begin finalizing checkpoints again.")]),e._v(" "),a("p",[a("code",[e._v("MIN_DEPOSIT_SIZE")]),e._v(" is set to 1500 ETH to form a natural upper bound on the total number of validators, bounding the overhead due to "),a("code",[e._v("vote")]),e._v(" messages. Using formulas found "),a("a",{attrs:{href:"https://medium.com/@VitalikButerin/parametrizing-casper-the-decentralization-finality-time-overhead-tradeoff-3f2011672735",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1),e._v(' under "From validator count to minimum staking ETH", we estimate that with 1500 ETH minimum deposit at an assumed ~10M in total deposits there will be approximately 900 validators at any given time. '),a("code",[e._v("vote")]),e._v("s are only sent after the first quarter of an epoch so 900 votes have to fit into 37 blocks or ~24 "),a("code",[e._v("vote")]),e._v("s per block. We have experimented with more dynamic models for "),a("code",[e._v("MIN_DEPOSIT_SIZE")]),e._v(", but these tend to introduce significant complexities and without data from a live network seem to be premature optimizations.")]),e._v(" "),a("h4",{attrs:{id:"initialize-epochs-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#initialize-epochs-2"}},[e._v("#")]),e._v(" Initialize Epochs")]),e._v(" "),a("p",[e._v("The call to the method at "),a("code",[e._v("INITIALIZE_EPOCH_BYTES")]),e._v(" at "),a("code",[e._v("CASPER_ADDR")]),e._v(" at the start of each epoch is a call to the "),a("code",[e._v("initialize_epoch")]),e._v(" method in the casper contract. This method can only be called once per epoch and is guaranteed by the protocol to be called at the start block of each epoch by "),a("code",[e._v("NULL_SENDER")]),e._v(". This method performs a number of bookkeeping tasks around incrementing variables, updating rewards, etc.")]),e._v(" "),a("p",[e._v("Any call to this method fails prior to the end of the "),a("code",[e._v("WARM_UP_PERIOD")]),e._v(". Thus the protocol does not begin executing "),a("code",[e._v("initialize_epoch")]),e._v(" calls until "),a("code",[e._v("block.number >= HYBRID_CASPER_FORK_BLKNUM + WARM_UP_PERIOD")]),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"issuance"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#issuance"}},[e._v("#")]),e._v(" Issuance")]),e._v(" "),a("p",[e._v("A fixed amount of 1.25M ETH was chosen as "),a("code",[e._v("CASPER_BALANCE")]),e._v(' to fund the casper contract. This gives the contract enough runway to operate for approximately 2 years (assuming ~10M ETH in validator deposits). Acting similarly to the "difficulty bomb", this "funding crunch" forces the network to hardfork in the relative near future to further fund the contract. This future hardfork is an opportunity to upgrade the contract and transition to full PoS.')]),e._v(" "),a("p",[e._v("The PoW block reward is reduced from 3.0 to 0.6 ETH/block over the course of approximately one year because the security of the chain is greatly shifted from PoW difficulty to PoS finality and because rewards are now issued to both validators and miners. Rewards are stepped down by 0.6 ETH/block every 3 months ("),a("code",[e._v("REWARD_STEPDOWN_BLOCK_COUNT")]),e._v(") to provide for a conservative transition period from full PoW to hybrid PoS/PoW. This gives validators time to become familiar with the new technology and begin logging on and also provides the network with more leeway in case of any unforeseen issues. If any major issues do arise, the Ethereum network will still have substantial PoW security to rely upon while decisions are made and/or patches are deployed. See "),a("a",{attrs:{href:"https://gist.github.com/djrtwo/bc864c0d0a275170183803814b207b9a",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1),e._v(" for further analysis of the current PoW security and of the effect of PoW block reward reduction in the context of Hybrid Casper FFG.")]),e._v(" "),a("p",[e._v("In addition to block rewards, miners now receive an issuance reward for including successful "),a("code",[e._v("vote")]),e._v(" transactions into the block on time. This reward is equal to 1/8th that of the reward the validator receives for a successful "),a("code",[e._v("vote")]),e._v(" transaction. Under optimal FFG conditions after group validator reward adjustments are made, miners receive approximately 1/5th of the total ETH issued by the Casper contract.")]),e._v(" "),a("p",[e._v("Below is a table of deposit sizes with associated annual interest rate and approximate time until funding crunch:")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Deposit Size")]),e._v(" "),a("th",[e._v("Annual Validator Interest")]),e._v(" "),a("th",[e._v("Funding Crunch")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("2.5M ETH")]),e._v(" "),a("td",[e._v("10.12%")]),e._v(" "),a("td",[e._v("~4 years")])]),e._v(" "),a("tr",[a("td",[e._v("10M ETH")]),e._v(" "),a("td",[e._v("5.00%")]),e._v(" "),a("td",[e._v("~2 years")])]),e._v(" "),a("tr",[a("td",[e._v("20M ETH")]),e._v(" "),a("td",[e._v("3.52%")]),e._v(" "),a("td",[e._v("~1.4 years")])]),e._v(" "),a("tr",[a("td",[e._v("40M ETH")]),e._v(" "),a("td",[e._v("2.48%")]),e._v(" "),a("td",[e._v("~1 year")])])])]),e._v(" "),a("h4",{attrs:{id:"gas-changes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gas-changes"}},[e._v("#")]),e._v(" Gas Changes")]),e._v(" "),a("p",[e._v("Normal block transactions cannot affect casper "),a("code",[e._v("vote")]),e._v(" validation results, but casper "),a("code",[e._v("vote")]),e._v(" validation results can affect normal block transaction execution. Due to this asymmetrical relationship, "),a("code",[e._v("vote")]),e._v(" transactions can be processed in parallel with normal block transactions if "),a("code",[e._v("vote")]),e._v(" transactions are placed after all normal block transactions. Because "),a("code",[e._v("vote")]),e._v(" transactions can be processed in parallel to normal block transactions, "),a("code",[e._v("vote")]),e._v(" transactions cost 0 gas for validators, ensuring that validators can submit votes even in highly congested or high gas-price periods.")]),e._v(" "),a("p",[a("code",[e._v("vote_gas_used")]),e._v(" is introduced to ensure that "),a("code",[e._v("vote")]),e._v(" transactions do not put an undue burden on block processing. The additional overhead from "),a("code",[e._v("vote")]),e._v(" transactions is capped at the same limit as normal block transactions so that, when run in parallel, neither sets of transactions exceeds the overhead defined by the "),a("code",[e._v("block_gas_limit")]),e._v(".")]),e._v(" "),a("p",[e._v("The call to "),a("code",[e._v("initialize_epoch")]),e._v(" at the beginning of each epoch requires 0 gas so that this protocol state transition does not take any gas allowance away from normal transactions.")]),e._v(" "),a("h4",{attrs:{id:"null-sender-and-account-abstraction"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#null-sender-and-account-abstraction"}},[e._v("#")]),e._v(" NULL_SENDER and Account Abstraction")]),e._v(" "),a("p",[e._v("This EIP implements a limited version of account abstraction for validators' "),a("code",[e._v("vote")]),e._v(" transactions. The general design was borrowed from "),a("RouterLink",{attrs:{to:"/zh/eip-86.html"}},[e._v("EIP-86")]),e._v(". Rather than relying upon native transaction signatures, each validator specifies a signature contract when sending their "),a("code",[e._v("deposit")]),e._v(" to "),a("code",[e._v("CASPER_ADDR")]),e._v(". When casting a "),a("code",[e._v("vote")]),e._v(", the validator bundles and signs the parameters of their "),a("code",[e._v("vote")]),e._v(" according to the requirements of their signature contract. The "),a("code",[e._v("vote")]),e._v(" method of the casper contract checks the signature of the parameters against the validator's signature contract, exiting the transaction as unsuccessful if the signature is not successfully verified.")],1),e._v(" "),a("p",[e._v("This allows validators to customize their own signing scheme for votes. Use cases include:")]),e._v(" "),a("ul",[a("li",[e._v("quantum-secure signature schemes")]),e._v(" "),a("li",[e._v("multisig wallets")]),e._v(" "),a("li",[e._v("threshold schemes")])]),e._v(" "),a("p",[e._v("For more details on validator account abstraction, see the "),a("a",{attrs:{href:"https://github.com/ethereum/casper/blob/master/VALIDATOR_GUIDE.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("Validator Implementation Guide"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"client-settings-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#client-settings-2"}},[e._v("#")]),e._v(" Client Settings")]),e._v(" "),a("h5",{attrs:{id:"enable-casper-fork-choice-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#enable-casper-fork-choice-2"}},[e._v("#")]),e._v(" Enable Casper Fork Choice")]),e._v(" "),a("p",[e._v("Releasing client versions with the casper fork choice as initially default disabled allows for a more conservative transition to hybrid Casper FFG. Under normal operating conditions there are no disparities between the PoW fork choice and the hybrid Casper FFG fork choice. The two fork choice rules can only diverge if either 51% of miners or 51% of validators are faulty.")]),e._v(" "),a("p",[e._v("Validators will begin to log on, vote, and finalize the FFG contract before the majority of the network begins explicitly relying upon the new finality mechanism. Once a significant number of validators have logged on and the finality mechanism has been tested on the live network, new client software versions that change the default to enabled will be released.")]),e._v(" "),a("h5",{attrs:{id:"non-revert-min-deposit-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#non-revert-min-deposit-2"}},[e._v("#")]),e._v(" NON_REVERT_MIN_DEPOSIT")]),e._v(" "),a("p",[a("code",[e._v("NON_REVERT_MIN_DEPOSIT")]),e._v(" is defined and configurable locally by each client. Clients are in charge of deciding upon the minimum deposits (security) at which they will accept the chain as finalized. In the general case, differing values in the choice of this local constant will not create any fork inconsistencies because clients with very strict finalization requirements will revert to follow the longest PoW chain.")]),e._v(" "),a("p",[e._v("Arguments have been made to hardcode a value into clients or the contract, but we cannot reasonably define security required for all clients especially in the context of massive fluctuations in the value of ETH.")]),e._v(" "),a("h5",{attrs:{id:"exclusion-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#exclusion-2"}},[e._v("#")]),e._v(" Exclusion")]),e._v(" "),a("p",[e._v("This setting is useful in coordinating minority forks in cases of majority collusion.")]),e._v(" "),a("h5",{attrs:{id:"join-fork-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#join-fork-2"}},[e._v("#")]),e._v(" Join Fork")]),e._v(" "),a("p",[e._v("This setting is to be used by new clients that are syncing the network for the first time. Due to weak subjectivity, a blockhash should be supplied to successfully sync the network when initially starting a node.")]),e._v(" "),a("p",[e._v("This setting is also useful for coordinating minority forks in cases of majority collusion.")]),e._v(" "),a("h5",{attrs:{id:"monitor-votes-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#monitor-votes-2"}},[e._v("#")]),e._v(" Monitor Votes")]),e._v(" "),a("p",[e._v("Monitoring the network for slashing conditions is key to Casper FFG's \"accountable safety\" as submitting proof of nefarious activity burns a validator's deposit.")]),e._v(" "),a("p",[e._v("This setting is suggested default disabled because the block producer will almost certainly frontrun anyone else submitting a "),a("code",[e._v("slash")]),e._v(" transaction. To prevent every client on the network from submitting a "),a("code",[e._v("slash")]),e._v(" transaction in the event of a slashing condition, this setting should only be enabled by block producers and those clients who explicitly choose to monitor votes.")]),e._v(" "),a("h2",{attrs:{id:"backwards-compatibility"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#backwards-compatibility"}},[e._v("#")]),e._v(" Backwards Compatibility")]),e._v(" "),a("p",[e._v("This EIP is not forward compatible and introduces backwards incompatibilities in the state, fork choice rule, block reward, transaction validity, and gas calculations on certain transactions. Therefore, all changes should be included in a scheduled hardfork at "),a("code",[e._v("HYBRID_CASPER_FORK_BLKNUM")]),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"copyright"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#copyright"}},[e._v("#")]),e._v(" Copyright")]),e._v(" "),a("p",[e._v("Copyright and related rights waived via "),a("a",{attrs:{href:"https://creativecommons.org/publicdomain/zero/1.0/",target:"_blank",rel:"noopener noreferrer"}},[e._v("CC0"),a("OutboundLink")],1),e._v(".")])])}),[],!1,null,null,null);t.default=n.exports}}]);